---
title: "Séries Temporais"
author: "Thiago Tavares Lopes  Lucas de Bona Sartor"
date: "`r format(Sys.time(), '%d %B %Y')`"
header-includes:
   - \usepackage[brazil]{babel}
   - \usepackage{bm}
   - \usepackage{float}
   - \usepackage{multirow}
   - \usepackage{tabularx}
   - \usepackage{booktabs}
geometry: left=2.5cm, right=2.5cm, top=2cm, bottom=2cm
output:
  bookdown::pdf_document2:
    fig.align: 'center'
editor_options:
  chunk_output_type: console
  markdown: 
    wrap: sentence
---
```{r setup, include=FALSE}
options(encoding = "UTF-8")
options(OutDec = ",")
options(scipen = 999, digits =5)
``` 

```{r, include=FALSE}
# BIBLIOTECAS

suppressMessages(library(forecast))
suppressMessages(library(tseries))
suppressMessages(library(lubridate))
suppressMessages(library(tidyverse))
suppressMessages(library(readr))
suppressMessages(library(ggpubr))
suppressMessages(library(ggplot2))


source("functions.R")
```



```{r, include=FALSE}

#DADOS

dados<- read_csv("dados/Gold Price (2013-2023).csv")

dados <- dados |> 
  mutate(Date = as.Date(Date, format = "%m/%d/%Y"))

media_mensal <- dados |> 
  mutate(Month = floor_date(Date, "month")) |> 
  group_by(Month) |> 
  summarise(Average_Price = mean(Price, na.rm = TRUE))
#View(media_mensal)


data_serie<-ts(media_mensal$Average_Price, frequency=12, start=c(2013,1))


```




# Introdução 

O ouro é um ativo financeiro para exportação, investimentos de longo prazo, consumo industrial e câmbio de moedas estrangeiras.  Segundo The Gold Bullion Company, o Brasil ocupa o 7° lugar no balanço mundial de oferta e demanda de ouro, com este contexto foi feito uma análise da série histórica do preço de comercialização do ouro entre os anos de 2013 a 2023. O *Dataset* utilizado pode ser acesso neste [link]{https://www.kaggle.com/code/farzadnekouei/gold-price-prediction-lstm-96-accuracy}.

A Figura \ref{fig:fig1}, apresenta a série temporal da precificação do ouro para os anos de 2013 até 2023.   


```{r, echo=FALSE, fig.align='center', fig.cap='Precificação mensal do Ouro - 2013 à 2023',label='fig1'}
# Gráficos

plot(data_serie, ylab = "Preço Mensal")

```


A Figura \ref{fig:fig2} apresenta a os resultados de Funcação de Autocorrelação e a Função de Autocorrelação Parical.

```{r, echo=FALSE, , fig.cap="FAC e FACP",label="fig2", fig.width=10, fig.height=8, fig.align='center'}
par(mfrow = c(2, 2)) 
acf_plot<-acf(data_serie, main= "Função de Autocorrelação")
pacf_plot<-pacf(data_serie, main = "Função de Autocorrelação Parcial")

```


\newpage

```{r, include=FALSE}

# verificar - Sazonalidade, raiz unitaria e tendencia

tend_determ(data_serie)

raiz_unit(data_serie)

sazonalidade(data_serie)

# resultado - 
```


Resultados de tendência, raiz unitária e sazonalidade

Resultados Tedência deterministica \ref{table:tab1}

\begin{table}[H]
\centering
\caption{Teste de Tedência determinística}
\label{table:tab1}
\begin{tabular}{@{}lcc@{}}
\toprule
\multicolumn{1}{c}{Teste} & p-valor & Conclusão \\ \midrule
Cox Stuart                & 0.0     & Tendência \\
Cox Stuart Trend          & 0.0     & Tendência \\
Mann-Kendall Trend        & 0.0     & Tendência \\
Mann-Kendall              & 0.0     & Tendência \\
KPSS Test for Trend       & 0.0     & Tendência \\ \bottomrule
\end{tabular}
\end{table}


Testes de Raiz unitária

\begin{table}[H]
\centering
\caption{Teste de Raiz Unitária}
\label{table:tab3}
\begin{tabular}{lcc}
\hline
\multicolumn{1}{c}{Teste} & p-valor & Conclusão \\ \hline
Augmented Dickey-Fuller   & 0.3553  & Tendência \\
Phillips-Perron Unit Root & 0.5252  & Tendência \\
KPSS Test for Level       & 0.0100  & Tendência \\ \hline
\end{tabular}
\end{table}


Teste de Sazonalidade 


\begin{table}[H]
\centering
\caption{Teste de Sazonalidade}
\label{table:tab3}
\begin{tabular}{@{}lcc@{}}
\toprule
\multicolumn{1}{c}{Teste} & p-valor & Conclusão   \\ \midrule
Kruskall Wallis           & 0.9991  & Não Sazonal \\
Friedman rank             & 0.8554  & Não sazonal \\ \bottomrule
\end{tabular}
\end{table}

XXX

Modelo EST

Medidas de qualidade(precisão)  do modelo.

o teste de Box-Pierce com lag 10, p-valor igual a 0.08726
```{r, include=FALSE}

modelo_ets <- ets(data_serie, model = "MAN", damped = TRUE)

summary(modelo_ets)

Box.test(modelo_ets$residuals,lag=10)

#modelo_ets$residuals

#checkresiduals(modelo_ets)
```

\begin{table}[H]
\centering
\caption{Medidas de Precisão}
\label{table:tab4}
\begin{tabular}{@{}ll@{}}
\toprule
\multicolumn{1}{c}{Medida} & \multicolumn{1}{c}{Valor} \\ \midrule
AIC                        & 1500.932                  \\
RMSE                       & 46.02785                  \\
MAE                        & 36.68431                  \\
MPE                        & 0.06388472                \\
MAPE                       & 2.550386                  \\
MASE                       & 0.2698339                 \\ \bottomrule
\end{tabular}
\end{table}

```{r, echo=FALSE}

#tsdisplay(modelo_ets$residuals, main = "Modelo MAN - Resíduos")



```

Análise de Resíduos

```{r, echo=FALSE}
checkresiduals(modelo_ets, test = F) 
```



```{r, echo=FALSE, message=FALSE}

ggqqplot(modelo_ets$residuals)+
  ggtitle("Resíduos Modelo MAN") +
  theme(plot.title = element_text(hjust = 0.5)) 

```


```{r, echo=FALSE, message=FALSE}
forecast_ets <- forecast(modelo_ets, h = 12)
plot(forecast_ets)

```






```{r, include=FALSE}
# diferenciação

# data_serie_diff<-diff(data_serie,differences = 1)
# plot(data_serie_diff)
# acf(data_serie_diff)
# adf.test(data_serie_diff, alternative = "stationary")
# 
# tend_determ(data_serie_diff)
# 
# raiz_unit(data_serie_diff)
# 
# sazonalidade(data_serie_diff)
# 
# plot(data_serie_diff)

```



```{r, include=FALSE}
# arima_model<-auto.arima(data_serie)
# 
# summary(arima_model)
# 
# checkresiduals(arima_model)
# 
# ggqqplot(arima_model$residuals)+ggtitle("Res?duos Modelo SES")


```



