---
title: "Séries Temporais"
author: "Thiago Tavares Lopes  Lucas de Bona Sartor"
date: "`r format(Sys.time(), '%d %B %Y')`"
header-includes:
   - \usepackage[brazil]{babel}
   - \usepackage{bm}
   - \usepackage{float}
   - \usepackage{multirow}
   - \usepackage{tabularx}
   - \usepackage{booktabs}
geometry: left=2.5cm, right=2.5cm, top=2cm, bottom=2cm
output:
  bookdown::pdf_document2:
    fig.align: 'center'
editor_options:
  chunk_output_type: console
  markdown: 
    wrap: sentence
---
```{r setup, include=FALSE}
options(encoding = "UTF-8")
options(OutDec = ",")
options(scipen = 999, digits =5)
``` 

```{r, include=FALSE}
# BIBLIOTECAS

suppressMessages(library(forecast))
suppressMessages(library(tseries))
suppressMessages(library(lubridate))
suppressMessages(library(tidyverse))
suppressMessages(library(readr))
suppressMessages(library(ggpubr))
suppressMessages(library(ggplot2))


source("functions.R")
```



```{r, include=FALSE}

#DADOS

dados<- read_csv("dados/Gold Price (2013-2023).csv")

dados <- dados |> 
  mutate(Date = as.Date(Date, format = "%m/%d/%Y"))

media_mensal <- dados |> 
  mutate(Month = floor_date(Date, "month")) |> 
  group_by(Month) |> 
  summarise(Average_Price = mean(Price, na.rm = TRUE))
#View(media_mensal)


data_serie<-ts(media_mensal$Average_Price, frequency=12, start=c(2013,1))


```




# Introdução 

O ouro é um ativo financeiro para exportação, investimentos de longo prazo, consumo industrial e câmbio de moedas estrangeiras.  Segundo The Gold Bullion Company, o Brasil ocupa o 7° lugar no balanço mundial de oferta e demanda de ouro, com este contexto foi feito uma análise da série histórica do preço de comercialização do ouro(em quilogramas) entre os anos de 2013 a 2023. O *Dataset* utilizado pode ser acesso neste [link](https://www.kaggle.com/code/farzadnekouei/gold-price-prediction-lstm-96-accuracy).

A Figura \ref{fig:fig1}, apresenta a série temporal da precificação mensal do ouro para os anos de 2013 até 2023. Em primeiro momento, de forma visual, nota-se que a série não possui sazonalidade, por conseguinte podemos observar um aumento significativo no preço do ouro entre 2019 a 2021.   


```{r, echo=FALSE, fig.align='center', fig.cap='Precificação mensal do Ouro - 2013 à 2023',label='fig1'}
# Gráficos

plot(data_serie, ylab = "Preço Mensal")

```

\newpage
A Figura \ref{fig:fig2} apresenta a os resultados de Funcação de Autocorrelação e a Função de Autocorrelação Parcial.

```{r, echo=FALSE, , fig.cap="FAC e FACP",label="fig2", fig.width=10, fig.height=8, fig.align='center'}
par(mfrow = c(2, 2)) 
acf_plot<-acf(data_serie, main= "Função de Autocorrelação")
pacf_plot<-pacf(data_serie, main = "Função de Autocorrelação Parcial")

```


\newpage
# Análise da Série Temporal 
Neste seção são apresentados os resultados da análise descritiva da série temporal.

## Análise Descritiva

```{r, include=FALSE}

# verificar - Sazonalidade, raiz unitaria e tendencia

tend_determ(data_serie)

raiz_unit(data_serie)

sazonalidade(data_serie)

# resultado - 
```


## Resultados de Tendência Determinística

A Tabela \ref{table:tab1} apresenta os resultados dos testes aplicados para verificar a presença de tendência determinística nos dados. Foram utilizados os testes Cox Stuart, Cox Stuart Trend, Mann-Kendall Trend, Mann-Kendall e KPSS para tendência. Em todos os casos, o p-valor obtido foi 0,0, indicando a rejeição da hipótese nula de ausência de tendência determinística. Com base nesses resultados, conclui-se que os dados analisados apresentam uma tendência clara e significativa.

\begin{table}[H]
\centering
\caption{Teste de Tedência determinística}
\label{table:tab1}
\begin{tabular}{@{}lcc@{}}
\toprule
\multicolumn{1}{c}{Teste} & p-valor & Conclusão \\ \midrule
Cox Stuart                & 0.0     & Tendência \\
Cox Stuart Trend          & 0.0     & Tendência \\
Mann-Kendall Trend        & 0.0     & Tendência \\
Mann-Kendall              & 0.0     & Tendência \\
KPSS Test for Trend       & 0.0     & Tendência \\ \bottomrule
\end{tabular}
\end{table}

## Resultados de Tedência Estocástica - Raiz Unitária

A Tabela \ref{table:tab2} apresenta os resultados dos testes de raiz unitária aplicados para avaliar a estacionaridade dos dados. Os testes utilizados foram: Augmented Dickey-Fuller, Phillips-Perron e KPSS. Para os testes Augmented Dickey-Fuller e Phillips-Perron, os p-valores encontrados foram 0,3553 e 0,5252, respectivamente, indicando a não rejeição da hipótese nula de presença de raiz unitária. Já no teste KPSS, o p-valor obtido foi 0,0100, levando à rejeição da hipótese nula de estacionaridade. Com base nos resultados, conclui-se que os dados apresentam uma tendência, não sendo estacionários em nível.

\begin{table}[H]
\centering
\caption{Teste de Raiz Unitária}
\label{table:tab2}
\begin{tabular}{lcc}
\hline
\multicolumn{1}{c}{Teste} & p-valor & Conclusão \\ \hline
Augmented Dickey-Fuller   & 0.3553  & Tendência \\
Phillips-Perron Unit Root & 0.5252  & Tendência \\
KPSS Test for Level       & 0.0100  & Tendência \\ \hline
\end{tabular}
\end{table}

## Testes de Sazonalidade 
A Tabela \ref{table:tab3} apresenta os resultados dos testes estatísticos realizados para verificar a presença de sazonalidade nos dados. Foram aplicados dois testes: o teste de Kruskal-Wallis e o teste de Friedman. O p-valor obtido no teste de Kruskal-Wallis foi de 0,9991, enquanto no teste de Friedman foi de 0,8554. Em ambos os casos, os p-valores são significativamente superiores ao nível de significância comumente adotado ($\alpha$ = 0,05). Assim, não se rejeita a hipótese nula de ausência de sazonalidade, indicando que os dados analisados não apresentam evidências de comportamento sazonal.


\begin{table}[H]
\centering
\caption{Teste de Sazonalidade}
\label{table:tab3}
\begin{tabular}{@{}lcc@{}}
\toprule
\multicolumn{1}{c}{Teste} & p-valor & Conclusão   \\ \midrule
Kruskall Wallis           & 0.9991  & Não Sazonal \\
Friedman rank             & 0.8554  & Não sazonal \\ \bottomrule
\end{tabular}
\end{table}

# Modelo Final

Para a série original foi aplicado um modelo de suavização exponencial. Temos que o estrutura do modelo da seguinte forma: 


$$
\mu_{t} = \ell_{t-1}+\phi b_{t-1}
$$ 

$$
\ell_{t} = \ell_{t-1}+\phi b_{t-1}+\alpha \epsilon_t
$$

$$
b_{t} = \phi b_{t-1}+\beta \epsilon_t
$$

Por conseguinte, a estrutura do modelo apresenta componentes multiplicativo para o erro (M), tendência aditiva suavizada (Ad) e ausência de sazonalidade (N). O modelo apresenta os seguintes parâmetros de suavização: $\alpha = 0.9999$ e $\beta = 0.0933$ e $\phi=0.8$.

Ademais, ss estados iniciais estimados foram $l = 1677.808$ para o nível e $b=-26.0755$ para tedência. O desvio padrão dos erros $\sigma$ é igual a 0.0326 indicando uma boa adequação do modelo da série. 

A Tabela \ref{table:tab4} apresenta os resultados de medidas de acurácia do modelo, ou seja, são informações de qualidade do ajuste. Temos os seguinte valores: AIC=1500.932, RMSE de 46,02785 e um MAE de 36,68431, O erro percentual médio (MPE) foi de 0,0639\%, e o erro percentual absoluto médio (MAPE) foi de 2,55\%, por último o erro padronizado absoluto médio (MASE) foi de 0,2698.
Esses valores sugerem que o modelo é parcimonioso e bem ajustado à série.



```{r, include=FALSE}

modelo_ets <- ets(data_serie, model = "MAN", damped = TRUE)

summary(modelo_ets)

Box.test(modelo_ets$residuals,lag=10)

#modelo_ets$residuals

#checkresiduals(modelo_ets)
```

\begin{table}[H]
\centering
\caption{Medidas de Precisão}
\label{table:tab4}
\begin{tabular}{@{}ll@{}}
\toprule
\multicolumn{1}{c}{Medida} & \multicolumn{1}{c}{Valor} \\ \midrule
AIC                        & 1500.932                  \\
RMSE                       & 46.02785                  \\
MAE                        & 36.68431                  \\
MPE                        & 0.06388472                \\
MAPE                       & 2.550386                  \\
MASE                       & 0.2698339                 \\ \bottomrule
\end{tabular}
\end{table}

```{r, echo=FALSE}

#tsdisplay(modelo_ets$residuals, main = "Modelo MAN - Resíduos")



```

# Análise de Resíduos

Neste seção são apresentados os resultados da análise dos resíduos do modelo para série. Primeiramente,  foi feito o teste de Box-Pierce com lag 10 e com $\alpha=5\%$, para avaliar a presenção de autocorrelação dos resíduos. Por conseguinte, o p-valor obtido foi de 0.08726
```{r, echo=FALSE}
checkresiduals(modelo_ets, test = F) 
```



```{r, echo=FALSE, message=FALSE}

ggqqplot(modelo_ets$residuals)+
  ggtitle("Resíduos Modelo MAN") +
  theme(plot.title = element_text(hjust = 0.5)) 

```

# Análise de Previsão

```{r, echo=FALSE, message=FALSE}
forecast_ets <- forecast(modelo_ets, h = 12)
plot(forecast_ets)

```


# Conclusão



```{r, include=FALSE}
# diferenciação

#data_serie_diff<-diff(data_serie,differences = 1)
# plot(data_serie_diff)
# acf(data_serie_diff)
# adf.test(data_serie_diff, alternative = "stationary")
# 
# tend_determ(data_serie_diff)
# 
# raiz_unit(data_serie_diff)
# 
# sazonalidade(data_serie_diff)
# 
# plot(data_serie_diff)

```



```{r, include=FALSE}
#arima_model<-auto.arima(data_serie_diff)
# 
#summary(arima_model)
# 
#checkresiduals(arima_model)
# 
#ggqqplot(arima_model$residuals)+ggtitle("Res?duos Modelo SES")


```



